     1                                 %line 1+1 fileSize.asm
     2                                 
     3                                 
     4                                 
     5                                 
     6                                 
     7                                 
     8                                 %line 1+1 macro.inc
     9                                 
    10                                 
    11                                 
    12                                 
    13                                 
    14                                 
    15                                 
    16                                 LF equ 10
    17                                 TAB equ 9
    18                                 ESC equ 27
    19                                 SPACE equ 32
    20                                 ASTERISK equ 42
    21                                 EOL equ 0
    22                                 VAR_SIZE equ 8
    23                                 MAX_PATH equ 4096
    24                                 false equ 0
    25                                 true equ 1
    26                                 EXIT_SUCCESS equ 0
    27                                 EXIT_FAILURE equ 1
    28                                 ZERO equ 0
    29                                 ONE equ 1
    30                                 
    31                                 [default rel]
    32                                 
    33                                 [extern printf]
    34                                 %line 25+0 macro.inc
    35                                 [extern puts]
    36                                 %line 26+1 macro.inc
    37                                 [extern strcmp]
    38                                 %line 26+0 macro.inc
    39                                 [extern strcat]
    40                                 [extern strlen]
    41                                 %line 27+1 macro.inc
    42                                 [extern strncmp]
    43                                 [extern strncpy]
    44                                 %line 28+0 macro.inc
    45                                 [extern strcpy]
    46                                 %line 29+1 macro.inc
    47                                 [extern strcasecmp]
    48                                 [extern malloc]
    49                                 %line 30+0 macro.inc
    50                                 [extern free]
    51                                 %line 31+1 macro.inc
    52                                 [extern memcpy]
    53                                 %line 31+0 macro.inc
    54                                 [extern memmove]
    55                                 %line 32+1 macro.inc
    56                                 [extern chdir]
    57                                 %line 32+0 macro.inc
    58                                 [extern strncat]
    59                                 [extern getcwd]
    60                                 %line 33+1 macro.inc
    61                                 [extern lstat]
    62                                 %line 33+0 macro.inc
    63                                 [extern getpwnam]
    64                                 %line 34+1 macro.inc
    65                                 [extern opendir]
    66                                 %line 34+0 macro.inc
    67                                 [extern readdir]
    68                                 [extern closedir]
    69                                 %line 35+1 macro.inc
    70                                 [extern getpwuid]
    71                                 %line 35+0 macro.inc
    72                                 [extern getgrgid]
    73                                 %line 36+1 macro.inc
    74                                 [extern readlink]
    75                                 [extern perror]
    76                                 [extern sprintf]
    77                                 %line 38+0 macro.inc
    78                                 [extern localtime]
    79                                 %line 39+1 macro.inc
    80                                 [extern strftime]
    81                                 %line 39+0 macro.inc
    82                                 [extern asctime]
    83                                 %line 40+1 macro.inc
    84                                 
    85                                 
    86                                 %line 45+1 macro.inc
    87                                 
    88                                 %line 51+1 macro.inc
    89                                 
    90                                 %line 56+1 macro.inc
    91                                 
    92                                 %line 61+1 macro.inc
    93                                 
    94                                 %line 66+1 macro.inc
    95                                 
    96                                 
    97                                 
    98                                 
    99                                 
   100                                 
   101                                 %line 76+1 macro.inc
   102                                 
   103                                 %line 81+1 macro.inc
   104                                 
   105                                 %line 85+1 macro.inc
   106                                 
   107                                 %line 89+1 macro.inc
   108                                 
   109                                 %line 93+1 macro.inc
   110                                 
   111                                 %line 98+1 macro.inc
   112                                 
   113                                 %line 102+1 macro.inc
   114                                 
   115                                 %line 107+1 macro.inc
   116                                 
   117                                 %line 112+1 macro.inc
   118                                 
   119                                 %line 116+1 macro.inc
   120                                 
   121                                 %line 121+1 macro.inc
   122                                 
   123                                 %line 125+1 macro.inc
   124                                 
   125                                 %line 130+1 macro.inc
   126                                 
   127                                 %line 136+1 macro.inc
   128                                 
   129                                 %line 141+1 macro.inc
   130                                 
   131                                 %line 147+1 macro.inc
   132                                 
   133                                 %line 153+1 macro.inc
   134                                 
   135                                 %line 158+1 macro.inc
   136                                 
   137                                 %line 163+1 macro.inc
   138                                 
   139                                 %line 168+1 macro.inc
   140                                 
   141                                 %line 174+1 macro.inc
   142                                 
   143                                 %line 181+1 macro.inc
   144                                 
   145                                 %line 185+1 macro.inc
   146                                 
   147                                 %line 190+1 macro.inc
   148                                 
   149                                 %line 195+1 macro.inc
   150                                 
   151                                 %line 202+1 macro.inc
   152                                 
   153                                 %line 206+1 macro.inc
   154                                 
   155                                 %line 214+1 macro.inc
   156                                 
   157                                 %line 218+1 macro.inc
   158                                 
   159                                 %line 224+1 macro.inc
   160                                 
   161                                 %line 230+1 macro.inc
   162                                 
   163                                 %line 234+1 macro.inc
   164                                 
   165                                 %line 241+1 macro.inc
   166                                 
   167                                 %line 245+1 macro.inc
   168                                 
   169                                 %line 250+1 macro.inc
   170                                 
   171                                 %line 257+1 macro.inc
   172                                 
   173                                 %line 264+1 macro.inc
   174                                 
   175                                 %line 268+1 macro.inc
   176                                 
   177                                 %line 274+1 macro.inc
   178                                 
   179                                 %line 279+1 macro.inc
   180                                 
   181                                 %line 284+1 macro.inc
   182                                 
   183                                 %line 288+1 macro.inc
   184                                 
   185                                 %line 293+1 macro.inc
   186                                 
   187                                 %line 298+1 macro.inc
   188                                 
   189                                 %line 303+1 macro.inc
   190                                 
   191                                 %line 307+1 macro.inc
   192                                 
   193                                 %line 312+1 macro.inc
   194                                 
   195                                 %line 317+1 macro.inc
   196                                 
   197                                 %line 324+1 macro.inc
   198                                 
   199                                 %line 334+1 macro.inc
   200                                 
   201                                 %line 338+1 macro.inc
   202                                 
   203                                 %line 343+1 macro.inc
   204                                 
   205                                 %line 349+1 macro.inc
   206                                 
   207                                 %line 353+1 macro.inc
   208                                 
   209                                 %line 357+1 macro.inc
   210                                 
   211                                 %line 362+1 macro.inc
   212                                 
   213                                 %line 366+1 macro.inc
   214                                 
   215                                 %line 371+1 macro.inc
   216                                 
   217                                 %line 376+1 macro.inc
   218                                 
   219                                 %line 381+1 macro.inc
   220                                 
   221                                 %line 386+1 macro.inc
   222                                 
   223                                 %line 391+1 macro.inc
   224                                 
   225                                 %line 395+1 macro.inc
   226                                 
   227                                 %line 400+1 macro.inc
   228                                 
   229                                 %line 404+1 macro.inc
   230                                 
   231                                 %line 411+1 macro.inc
   232                                 
   233                                 %line 415+1 macro.inc
   234                                 
   235                                 %line 420+1 macro.inc
   236                                 
   237                                 %line 424+1 macro.inc
   238                                 
   239                                 %line 433+1 macro.inc
   240                                 
   241                                 
   242                                 %line 8+1 fileSize.asm
   243                                 
   244                                 
   245                                 [global printFileSize]
   246                                 
   247                                 %line 20+1 fileSize.asm
   248                                 
   249                                 %line 22+1 fileSize.asm
   250                                 
   251                                 
   252                                 %line 27+1 fileSize.asm
   253                                 
   254                                 
   255                                 [section .text]
   256                                 
   257                                 printFileSize:
   258 00000000 55                      push rbp
   259                                 %line 32+0 fileSize.asm
   260 00000001 4889E5                  mov rbp, rsp
   261 00000004 4883E4F0                and rsp, -16
   262 00000008 4883EC20                sub rsp, 4 * 8
   263                                 %line 33+1 fileSize.asm
   264                                 
   265 0000000C 48893C24                mov qword [rsp + VAR_SIZE * (4 - 4)], rdi
   266 00000010 488B0424                mov rax, qword [rsp + VAR_SIZE * (4 - 4)]
   267 00000014 483DE8030000            cmp rax, 1000
   268 0000001A 0F8290000000            jb .belowDivisor
   269                                 
   270 00000020 488B05(F2FFFFFF)        mov rax, [sizeArray]
   271 00000027 4889442408              mov qword [rsp + VAR_SIZE * (4 - 3)], rax
   272 0000002C 4831C9                  xor rcx, rcx
   273                                 
   274                                 .topOfLoop:
   275 0000002F 4889442408              mov qword [rsp + VAR_SIZE * (4 - 3)], rax
   276 00000034 48390424                cmp qword [rsp + VAR_SIZE * (4 - 4)], rax
   277 00000038 7200                    jb .bottomOfLoop
   278 0000003A EB10                    jmp .proceed
   279                                 
   280                                 .bottomOfLoop:
   281 0000003C 48FFC1                  inc rcx
   282 0000003F 488B04CD[00000000]      mov rax, [sizeArray + 8 * rcx]
   283 00000047 4889442408              mov qword [rsp + VAR_SIZE * (4 - 3)], rax
   284 0000004C EBDF                    jmp .topOfLoop
   285                                 
   286                                 .proceed:
   287 0000004E 4898                    cdqe
   288                                 %line 56+0 fileSize.asm
   289 00000050 488B0424                mov rax, qword [rsp + VAR_SIZE * (4 - 4)]
   290 00000054 4C8B442408              mov r8, qword [rsp + VAR_SIZE * (4 - 3)]
   291 00000059 49F7F0                  div r8
   292 0000005C 4889D0                  mov rax, rdx
   293 0000005F 4885C0                  test rax, rax
   294                                 %line 57+1 fileSize.asm
   295 00000062 7400                    jz .integerDivide
   296 00000064 EB25                    jmp .nonIntegerDivide
   297                                 
   298                                 .integerDivide:
   299 00000066 488B0424                mov rax, qword [rsp + VAR_SIZE * (4 - 4)]
   300 0000006A 4C8B442408              mov r8, qword [rsp + VAR_SIZE * (4 - 3)]
   301 0000006F 4898                    cdqe
   302 00000071 49F7F0                  div r8
   303 00000074 488D3D(F2FFFFFF)        lea rdi, [szModMultiplierZero]
   304 0000007B 4889C6                  mov rsi, rax
   305 0000007E 8A91[00000000]          mov dl, byte [rangeArray + rcx]
   306 00000084 31C0                    xor eax, eax
   307                                 %line 68+0 fileSize.asm
   308 00000086 E8(F6FFFFFF)            call printf
   309                                 %line 69+1 fileSize.asm
   310 0000008B EB39                    jmp .fin
   311                                 
   312                                 .nonIntegerDivide:
   313 0000008D F20F100424              movsd xmm0, qword [rsp + VAR_SIZE * (4 - 4)]
   314 00000092 F20F104C2408            movsd xmm1, qword [rsp + VAR_SIZE * (4 - 3)]
   315 00000098 F20F5EC1                divsd xmm0, xmm1
   316 0000009C 488D3D(F2FFFFFF)        lea rdi, [szModMultiplierNotZero]
   317                                 
   318 000000A3 4831D2                  xor rdx, rdx
   319 000000A6 8A91[00000000]          mov dl, byte [rangeArray + rcx]
   320 000000AC 4889D6                  mov rsi, rdx
   321 000000AF E813000000              call printsd
   322 000000B4 EB10                    jmp .fin
   323                                 
   324                                 .belowDivisor:
   325 000000B6 488D3D(F2FFFFFF)        lea rdi, [szFmt]
   326 000000BD 488B3424                mov rsi, qword [rsp + VAR_SIZE * (4 - 4)]
   327 000000C1 31C0                    xor eax, eax
   328                                 %line 86+0 fileSize.asm
   329 000000C3 E8(F6FFFFFF)            call printf
   330                                 %line 87+1 fileSize.asm
   331                                 
   332                                 .fin:
   333 000000C8 31C0                    xor eax, eax
   334                                 
   335                                 .exit:
   336 000000CA C9                      leave
   337                                 %line 92+0 fileSize.asm
   338 000000CB C3                      ret
   339                                 %line 93+1 fileSize.asm
   340                                 
   341                                 
   342                                 printsd:
   343 000000CC 55                      push rbp
   344                                 %line 96+0 fileSize.asm
   345 000000CD 4889E5                  mov rbp, rsp
   346 000000D0 4883E4F0                and rsp, -16
   347                                 %line 97+1 fileSize.asm
   348                                 
   349 000000D4 B801000000              mov eax, ONE
   350 000000D9 E8(F6FFFFFF)            call printf
   351                                 
   352 000000DE C9                      leave
   353                                 %line 101+0 fileSize.asm
   354 000000DF C3                      ret
   355                                 %line 102+1 fileSize.asm
   356                                 
   357                                 
   358                                 
   359                                 %line 127+1 fileSize.asm
   360                                 
   361                                 
   362                                 [section .data]
   363                                 
   364 00000000 0000000000000000       nFileSize dq 0
   365 00000008 256C6C642000           szFmt db "%lld ", EOL
   366 0000000E 256C6C642E30256320-    szModMultiplierZero db "%lld.0%c ", EOL
   367 0000000E 00                 
   368 00000018 252E316625632000       szModMultiplierNotZero db "%.1f%c ", EOL
   369                                 
   370 00000020 5054474D4B42           rangeArray db 'P', 'T', 'G', 'M', 'K', 'B'
   371                                 
   372 00000026 0080C6A47E8D030000-    sizeArray dq 1000 * 1000 * 1000 * 1000 * 1000, 1000 * 1000 * 1000 * 1000, 1000 * 1000 * 1000, 1000 * 1000, 1000, 1
   373 00000026 10A5D4E800000000CA-
   374 00000026 9A3B0000000040420F-
   375 00000026 0000000000E8030000-
   376 00000026 000000000100000000-
   377 00000026 000000             
   378                                 
   379 00000056 00000000000000000A-    nFileSizes dq 0, 10, 100, 999,
   380 00000056 000000000000006400-
   381 00000056 000000000000E70300-
   382 00000056 0000000000         
   383 00000076 E80300000000000061-     dq 1000, 1121, 21000, 22007,
   384 00000076 040000000000000852-
   385 00000076 000000000000F75500-
   386 00000076 0000000000         
   387 00000096 5B56000000000000D0-     dq 22107, 1250000, 135000000,
   388 00000096 12130000000000C0EF-
   389 00000096 0B0800000000       
   390 000000AE 00A7A9240300000000-     dq 13500000000, 13500000000000,
   391 000000AE 58B436470C0000     
   392 000000BE BADCFE0000000000        dq 0xfedcba
   393                                 
   394                                 
